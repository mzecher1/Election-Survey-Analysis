---
title: "MZ Review"
author: "Mendel Zecher"
date: "7/01/2020"
output:
  word_document: default
  github_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Install packages if first time
```{r eval=FALSE}
install.packages('dplyr')
install.packages('readr')
install.packages('tidyr')
install.packages('stringr')
install.packages('forcats')
install.packages('purr')
install.packages("ggpubr")
install.packages('car')
install.packages('gdata')
install.packages("skimr")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Read in Packages needed
```{r message=FALSE}
library(dplyr) # manipulate dataframes
library(readr) # read/write dataframes
library(tidyr) # reshaping dataframes
library(stringr) # string manipulation
library(forcats) # factor manipulation
library(purrr) # iteration (instead of loops)
library(ggpubr) # for Correlation
library(ggplot2) # for Plots
library ('car')
library ('gdata')
library('skimr') 
```

#Import the data- ANES Survey Timeseries

# Unzip the ANES data if needed
```{r}
source("unzip-anes-data.R")
```

```{r}
library(haven)
anes_timeseries_cdf_stata13 <- read_dta("data-raw/anes_timeseries_cdf_stata13.dta")
```
# Filtering for the right years 
```{r}
June_DS <-anes_timeseries_cdf_stata13[!(anes_timeseries_cdf_stata13$VCF0004<"2004"),]
```

```{r}
# Removing Labels

June_DS %>% 
  zap_labels() %>% 
  select(
    VCF0102,
    VCF0104, 
    VCF0880, 
    VCF0606, 
    VCF0501,
    VCF9030a,
    VCF9206, 
    VCF0105b, 
    VCF0450, 
    VCF0301,  
    VCF9206, 
    VCF9202,
    VCF0358, 
    VCF0360, 
    VCF0370, 
    VCF0372, 
    VCF9253, 
    VCF0714, 
    VCF9256, 
    VCF0900b, 
    VCF0114, 
    VCF9021,  
    VCF9030b,
    VCF9030c,	  
    VCF9222, 
    VCF0901a,
    VCF0009z,
    VCF0702,
  ) %>% 
  skim()

```

# Filtering the Dataset for the right variables
```{r}

June_DS_30 = subset(June_DS, select = c(VCF0102,
    VCF0104,
    VCF0702,
    VCF0880, 
    VCF0606, 
    VCF0501,
    VCF9030a,
    VCF9206, 
    VCF0105b, 
    VCF0450, 
    VCF0301,  
    VCF9202,
    VCF0358, 
    VCF0360, 
    VCF0370, 
    VCF0372, 
    VCF0714, 
    VCF9256, 
    VCF0900b, 
    VCF0114, 
    VCF9030b,
    VCF9030c,	  
    VCF9222,
    VCF9201,
     VCF0901a,
    VCF0009z))
```

# Dealing w/ missings
```{r}

mutate(June_DS_30, VCF0501 = is.na, 9)

Replace_MISS <- June_DS_30$VCF0501[June_DS_30$VCF0501==is.na] <- 9

Replace_MISS <- June_DS_30(VCF0501 = c(NA, 9))

```


```{r}

Final_DS <- June_DS_30 %>% 
    rename(
    control_split = VCF9206,
    Voted_Y_N = VCF0702,
    Race = VCF0105b,
    Weights = VCF0009z,
    Dem_Pres_Angry = VCF0358,
    Dem_Pres_hopeful= VCF0360,
    Rep_Pres_Angry = VCF0370,
    Rep_Pres_hopeful = VCF0372,
    Election_Close = VCF0714,
    Age = VCF0102,
    Gender = VCF0104,
    Better_worse = VCF0880,
    FED_Tax = VCF0606,
    Bw_parties = VCF0501,
    contacted_by_party = VCF9030a,
    Volunteer_work = VCF9256,
    State_CD = VCF0900b,
    Income = VCF0114,
    Contacted_Dem_Party = VCF9030b,
    Contacted_Rep_Party =VCF9030c,	 	 	 		
		Country_direction = VCF9222,
    State = VCF0901a,
		Approve_President = VCF0450, 
    Party = VCF0301,
		Like_dislike_Rep_party = VCF9202,
		Like_dislike_Dem_party = VCF9201
)

```
attach(June_DS_30)
n_perc(June_DS_30$VCF0702 == 0)

# Creating Dummy Variables
```{r}
   
    Final_DS_DV <- Final_DS %>% 
    mutate(
    Age_Dummy = factor(Age),
    Gender_DV = factor(Gender),
    bw_parties_DV = factor(Bw_parties),
    Contacted_by_party_DV = factor(contacted_by_party),
    Control_split_DV = factor(control_split),
    Race_DV = factor(Race),
    Election_Close_DV = factor(Election_Close),
    Better_worse_DV = factor(Better_worse),
    contacted_by_party_DV = factor(contacted_by_party),
    Volunteer_DV = ifelse (Volunteer_work > 1, 1, 0),
    Income_DV = factor(Income),
    Appove_Pres = factor(Approve_President),
    Voted_Y_N_DV = ifelse (Voted_Y_N > 1, 1, 0),
    Country_direction_DV = ifelse (Country_direction > 1, 0, 1)
  )
```  


# Regression 
```{r}

reg_DV <- lm(Voted_Y_N_DV ~ Age_Dummy + Gender_DV + Race_DV + bw_parties_DV + Contacted_by_party_DV + Control_split_DV + Election_Close_DV + Better_worse_DV +Volunteer_DV  + Income_DV + Country_direction_DV, weights= Weights, data=Final_DS_DV)

summary(reg_DV)


``` 


