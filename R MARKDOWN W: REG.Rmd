---
output: github_document
---

# Install packages if first time
```{r eval=FALSE}
install.packages('dplyr')
install.packages('readr')
install.packages('tidyr')
install.packages('stringr')
install.packages('forcats')
install.packages('purr')
install.packages("ggpubr")
install.packages('car')
install.packages('gdata')
```

# Read in Packages needed
```{r message=FALSE}
library(dplyr) # manipulate dataframes
library(readr) # read/write dataframes
library(tidyr) # reshaping dataframes
library(stringr) # string manipulation
library(forcats) # factor manipulation
library(purrr) # iteration (instead of loops)
library(ggpubr) # for Correlation
library(ggplot2) # for Plots
library ('car')
library ('gdata')
```

Unzip the ANES data if needed
```{r}
source("unzip-anes-data.R")
```


# Import the data- ANES Survey Timeseries
```{r}
library(haven)
anes_timeseries_cdf_stata13 <- read_dta("data-raw/anes_timeseries_cdf_stata13.dta")
```

# Filter to 2004

```{r}
# Updated1 <-anes_timeseries_cdf_stata13[!(anes_timeseries_cdf_stata13$VCF0004<"2004"),]
Updated1 <- filter(anes_timeseries_cdf_stata13, VCF0004 >= 2004)
```

# select variables 

```{r}
Condensed_weights  = subset(Updated1, select = c(VCF0004, VCF0102, VCF0103, VCF0104,VCF0105a, VCF0105b,VCF0106,VCF0107, VCF0700,VCF0201,VCF0202, VCF0301 ,VCF0303, VCF0314 ,VCF0315 ,VCF0323 ,VCF0501,VCF9008,VCF9010 ,VCF9011,VCF9012, VCF9201,VCF9202 ,VCF9203,VCF9204,VCF9206,VCF0350 ,VCF0351 ,VCF0352,VCF0353 , VCF0354 ,VCF0355,VCF0356 ,VCF0357 ,VCF0358 ,VCF0363 ,VCF0364,VCF0365 ,VCF0366 ,VCF0367, VCF0368 ,VCF0369 ,VCF0370,VCF0371 ,VCF0372,VCF0373 ,VCF0412 ,VCF0414 ,VCF0906 ,VCF0907,VCF0908 ,VCF0909 ,VCF0450,VCF0451,VCF9217,VCF9218,  VCF9220,VCF9221,VCF0875 ,VCF0875a ,VCF0875b ,VCF9019,VCF9020 ,VCF9052,VCF9222,VCF0803,VCF9240, VCF0228 ,VCF0231 ,VCF0601,VCF0602, VCF0603, VCF0604 ,VCF0608 ,VCF0656,VCF9250,VCF9251,VCF9252,VCF9253,VCF9254,VCF9256,VCF9257,VCF0308,VCF0309,
  VCF0310,VCF0311,VCF0312,VCF0313,VCF0700,VCF0714,VCF0729 ,VCF0730,VCF0731,VCF0732,VCF0733,VCF0743,VCF0932,VCF0933,VCF0934,VCF0935,VCF0936,VCF0941, VCF0942, VCF0943, VCF0944, VCF0945 , VCF0946 ,VCF0947, VCF0948, VCF0949,VCF9064,VCF0717,VCF0723,VCF0723a,VCF0746,VCF0747 ,VCF9021 ,VCF9030,VCF9030a,
VCF0701 ,VCF0702 , VCF0703 , VCF0704 , VCF0704a , VCF0705, VCF0706, VCF0707 , VCF0711, VCF0708, VCF0713 , VCF0712, VCF0748, VCF0749,VCF0750,VCF9022,VCF9023,VCF0675,VCF0724,VCF0725,VCF0726,VCF0727,VCF0728,VCF0744,VCF0745,VCF9032,VCF9033,VCF9034,VCF9035, VCF9266, VCF0102, VCF0104, VCF9222, VCF0880, VCF9229, VCF0606, VCF9030a, VCF0322, VCF9206, VCF0105b, VCF0009z, VCF0900b,
VCF0870,
VCF9225,
VCF0607,
VCF0611))


```

# Filter out the columns that are not relevant- have all missings (questions from older surveys (two ways)

```{r}
Updated_data <- Condensed_weights [ , colSums(is.na(Condensed_weights)) <nrow(Condensed_weights)]

data_new3 <- Condensed_weights [ , colSums(is.na(Condensed_weights)) <nrow(Condensed_weights)]
```

# attach to frame- checking for missings + descriptive stats

```{r}
# attach(Condensed_weights)
# summary (VCF9021)
# summary (VCF9030a)
# summary (VCF0728)
# summary (VCF0745)
# summary (VCF9034)
# summary (VCF0724)
# summary (VCF0301)
# summary (VCF9206)
# summary (VCF9222)
# summary (VCF0870)
# summary (VCF0880)
# summary (VCF9225)
# summary (VCF9229)
# summary (VCF0606)
# summary (VCF0607)
# summary (VCF0611)
# summary (VCF0613)
# summary (VCF0617)
# summary (VCF0632)
# summary (VCF0650)
# summary (VCF0501)
# summary (VCF0731)
# summary (VCF0733)
# summary (VCF0310)
# summary (VCF0312)
# summary (VCF0311)
# summary (VCF0653)
# summary (VCF0359)
# summary (VCF0360)
# summary (VCF0361)
# summary (VCF0370)
# summary (VCF0371)
# summary (VCF0372)
# summary (VCF0373)
# summary(VCF0702)

# Many of the columns listed above aren't present in the dataset after the
# subset of columns, so it seems like you should instead use the dataframe
# "Updated1". Also attach can often cause some confusion about what is in your
# environment, so some of the tidyverse alternatives can make things a little
# easier. Here for example you can select this subset of columns and use skim to
# get summary of all the columns at once.

library(skimr) # install.packages("skimr")

Updated1 %>% 
  # The labels confuse this function, so we'll remove them before calling skim()
  zap_labels() %>% 
  select(
    VCF9021,
    VCF9030a,
    VCF0728,
    VCF0745,
    VCF9034,
    VCF0724,
    VCF0301,
    VCF9206,
    VCF9222,
    VCF0870,
    VCF0880,
    VCF9225,
    VCF9229,
    VCF0606,
    VCF0607,
    VCF0611,
    VCF0613,
    VCF0617,
    VCF0632,
    VCF0650,
    VCF0501,
    VCF0731,
    VCF0733,
    VCF0310,
    VCF0312,
    VCF0311,
    VCF0653,
    VCF0359,
    VCF0360,
    VCF0361,
    VCF0370,
    VCF0371,
    VCF0372,
    VCF0373,
    VCF0702
  ) %>% 
  skim()
```

#Add Labels

```{r}
names(Condensed_weights)[names(Condensed_weights) == "VCF0301"] <- "Party Identification of Respondent-7-point Scale"
Condensed_weights
```

# Tables/Cross Tabs

# Voted

```{r}
Condensed_weights %>% with(table(VCF0702))
```

# Voted-Contacted by a Major Party?

```{r}
Table1 <- Condensed_weights %>% with(table(VCF0702, VCF9030a))
Table1
```

# Diff b/w parties?
```{r}
attach(Condensed_weights)
table(VCF0501)

table(VCF0702, VCF0501)

Dem_Voters <- table(VCF0702, VCF0314)
round(prop.table(Dem_Voters,1),2)

Diff_parties <- table(VCF0702, VCF0501)
Diff_parties
round(prop.table(Diff_parties,1),2)

# (Less incentivized to vote if think there the same)

Dislike_DEM <- table(VCF0702, VCF9201)
Dislike_DEM

Dislike_REP <- table(VCF0702, VCF9202)

Rep_views <- table(VCF0702, VCF9203)
round(prop.table(Rep_views,1),2)

which_party <- table(VCF0702, VCF9204)
round(prop.table(which_party,1),2)

Party_pref <- table(VCF0702, VCF9206)
round(prop.table(Party_pref,1),2)

Dem_Smart <- table(VCF0702, VCF0350)
round(prop.table(Dem_Smart,1),2)

Dem_Angry <- table(VCF0702, VCF0358)
round(prop.table(Dem_Angry,1),2)

REP_Angry <- table(VCF0702, VCF0370)
round(prop.table(REP_Angry,1),2)

Approve_Pres <- table(VCF0702, VCF0450)
round(prop.table(Approve_Pres,1),2)

Approve_Pres_rating <- table(VCF0702, VCF0451)
round(prop.table(Approve_Pres_rating,1),2)

Pres_Econ <- table(VCF0702, VCF9220)
round(prop.table(Pres_Econ,1),2)

Right_Track <- table(VCF0702, VCF9222)
round(prop.table(Right_Track,1),2)

LIB_CON <- table(VCF0702, VCF0803)
round(prop.table(LIB_CON,1),2)

Trust_Fed_Gov <- table(VCF0702, VCF0604)
round(prop.table(Trust_Fed_Gov,1),2)

Crooked_FED <- table(VCF0702, VCF0608)
round(prop.table(Crooked_FED,1),2)

TRUST_GOV_GEN <- table(VCF0702, VCF0656)
round(prop.table(TRUST_GOV_GEN,1),2)

Volunteer <- table(VCF0702, VCF9256)
round(prop.table(Volunteer,1),2)

Interst_Elec <- table(VCF0702, VCF0310)
round(prop.table(Interst_Elec,1),2)

Care_win <- table(VCF0702, VCF0311)
round(prop.table(Care_win,1),2)

Care_win_CONG <- table(VCF0702, VCF0312)
round(prop.table(Care_win_CONG,1),2)

Pred_Close <- table(VCF0702, VCF0714)
round(prop.table(Pred_Close,1),2)

Pred_Close

detach(Condensed_weights)
```

# Correlation
```{r}
# A good alternative to attach() is with(), it does the same thing but is
# limited to just the one use, and won't change your environment for the rest of
# the session the way attach does

res <- Condensed_weights %>% 
  with(
     cor.test(VCF0702, VCF0102, 
                method = "pearson")
     )

res
```

# rename variables 

```{r}
# attach(Condensed_weights)
# 
# names(Condensed_weights)[names(Condensed_weights)=="VCF0102"] <- "Age"
# names(Condensed_weights)[names(Condensed_weights)=="VCF0104"] <- "Gender"
# names(Condensed_weights)[names(Condensed_weights)=="VCF9229"] <- "UE"
# names(Condensed_weights)[names(Condensed_weights)=="VCF0880"] <- "Better_worse"
# names(Condensed_weights)[names(Condensed_weights)=="VCF0606"] <- "FED_Tax"
# names(Condensed_weights)[names(Condensed_weights)=="VCF0501"] <- "Bw_parties"
# names(Condensed_weights)[names(Condensed_weights)=="VCF9030a"] <- "contacted_by_party"
# names(Condensed_weights)[names(Condensed_weights)=="VCF9206"] <- "control_split"
# names(Condensed_weights)[names(Condensed_weights)=="VCF0105b"] <- "Race"
# names(Condensed_weights)[names(Condensed_weights)=="VCF9222"] <- "Country_direction"

# rename() can make this a bit easier to write/read
Condensed_weights_renamed <- Updated1 %>% 
  rename(
    Age = VCF0102,
    Gender = VCF0104,
    UE = VCF9229,
    Better_worse = VCF0880,
    FED_Tax = VCF0606,
    Bw_parties = VCF0501,
    contacted_by_party = VCF9030a,
    control_split = VCF9206,
    Race = VCF0105b,
    Country_direction = VCF9222
  )
```

```{r}
Condensed_weights_renamed %>% zap_labels() %>% skim(Age)
```

# Regressions

# creating dummy variables 

```{r}

Condensed_weights_w_factors <- Condensed_weights_renamed %>% 
  mutate(
    Age_Dummy = factor(Age),
    Gender_DV = factor(Gender),
    Future_UE_Var = factor(UE),
    Better_worse_dummy = factor(Better_worse),
    FED_Gov_tax_dummy = factor(FED_Tax),
    bw_parties_DV = factor(Bw_parties),
    Contacted_by_party_DV = factor(contacted_by_party),
    Control_split_DV = factor(control_split),
    Race_DV = factor(Race),
    Dummy_dep_voting = ifelse (VCF0702 > 1, 1, 0),
    Dummy_right_dir = ifelse (Country_direction > 1, 0, 1),
  )

Condensed_weights_w_factors %>% 
  zap_labels() %>% 
  select(
    Age_Dummy,
    Gender_DV,
    Future_UE_Var,
    Better_worse_dummy,
    FED_Gov_tax_dummy,
    bw_parties_DV,
    Contacted_by_party_DV,
    Control_split_DV,
    Race_DV,
    Dummy_dep_voting,
    Dummy_right_dir
  ) %>% 
  skim()

reg_Dummyvar <- lm(Dummy_dep_voting ~ Age_Dummy + Gender_DV + Dummy_right_dir + Better_worse_dummy + Future_UE_Var + FED_Gov_tax_dummy + bw_parties_DV  + Contacted_by_party_DV + Control_split_DV + Race_DV, weights= VCF0009z, data=Condensed_weights_w_factors)

summary(reg_Dummyvar)

```



